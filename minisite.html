<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Minisite</title>
	<script>
		const data = `
[h1]Big header[/]
Here is some text that's cool I guess.
[bul]
[h2][a https://github.com/dairycultist/MiniSiteParser]Page 1[/][/]
Here's some info on page 1.
[/]
[bul]
[h2][a https://github.com/dairycultist/MiniSiteParser]Page 2[/][/]
Here's some info on page 2.
[/]
[/]
		`;

		const opening_tag_regex = /\[([^\[\]]+)\]/;

		class Node {

			constructor(tag_name, child_nodes, data) {
				this.tag_name = tag_name; // string
				this.child_nodes = child_nodes; // array of Nodes
				this.data = data; // string
			}

			children_html() {

				let construct = "";

				for (let child of this.child_nodes) {
					construct += child.to_html();
				}

				return construct;
			}

			to_html() {

				switch (this.tag_name) {
					case "text": return this.data;
					case "h1": return "<h1>" + this.children_html() + "</h1>";
					case "h2": return "<h2>" + this.children_html() + "</h2>";
					case "a": return "<a href='" + this.data + "'>" + this.children_html() + "</a>";
					case "bul": return "<ul><li>" + this.children_html() + "</li></ul>";
					default: return this.children_html(); // return "<fieldset><legend>" + this.tag_name + "</legend>" + this.children_html() + "</fieldset>";
				}
			}
		}

		function parse(string) { // recursive function, returns { nodes: list of node objects, string: reduced string after parsing }

			// no more siblings to parse
			if (string.length == 0 || string.startsWith("[/]")) {

				return {
					nodes: [],
					string: string
				};
			}

			// parse next sibling node
			if (string.search(opening_tag_regex) == 0) {

				const opening_tag = opening_tag_regex.exec(string);

				string = string.substring(opening_tag[0].length);	// remove opening tag
				({ nodes, string } = parse(string));				// parse child nodes of this node
				string = string.replace("[/]", "");					// remove closing tag

				let children = nodes;

				({ nodes, string } = parse(string)); // parse following siblings

				// parse out tag name from data
				let tag_parts = opening_tag[1].split(" ", 2);

				return {
					nodes: [ new Node(tag_parts[0], children, tag_parts[1]) ].concat(nodes),
					string: string
				};
			}

			// parse next sibling text node
			const end_of_text_node = string.search(opening_tag_regex) != -1 ? string.search(opening_tag_regex) : string.indexOf("[/]") != -1 ? string.indexOf("[/]") : string.length;

			const text = string.substring(0, end_of_text_node);
			string = string.substring(end_of_text_node);

			({ nodes, string } = parse(string)); // parse following siblings

			return {
				nodes: [ new Node("text", [], text) ].concat(nodes),
				string: string
			};
		}
	</script>
</head>
<body onload="document.body.innerHTML = new Node('body', parse(data).nodes, {}).to_html();">
	<img src="minisite.png" height="400"><br>
</body>
</html>